<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>kamuicode Config Manager</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- js-yaml CDN (YAMLãƒ‘ãƒ¼ã‚µãƒ¼) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
    <!-- Alpine.js CDN (ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–UI) -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.1/dist/cdn.min.js" defer></script>
    <style>
        /* Interãƒ•ã‚©ãƒ³ãƒˆã®èª­ã¿è¾¼ã¿ */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        /* ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’å›ºå®šã—ã€ã‚»ãƒ«ã®æŠ˜ã‚Šè¿”ã—ã‚’å¼·åˆ¶ */
        table {
            table-layout: fixed;
            width: 100%;
        }
        th, td {
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        /* ã‚½ãƒ¼ãƒˆã‚¢ã‚¤ã‚³ãƒ³ç”¨ã®ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ« */
        .sort-icon {
            opacity: 0.5;
            transition: opacity 0.2s;
        }
        th:hover .sort-icon {
            opacity: 1;
        }
        /* Alpine.js ã§éè¡¨ç¤ºã«ã™ã‚‹ãŸã‚ã®ã‚¯ãƒ©ã‚¹ */
        .hidden {
            display: none;
        }
    </style>

    <!-- Alpine.jsã®é–¢æ•°å®šç¾© -->
    <script>
        function modelManager() {
            // LocalStorage ã‚­ãƒ¼
            const LS_KEY_MODE = 'kamui_config_mode';
            const LS_KEY_YAML_DATA = 'kamui_config_yaml_data';
            const LS_KEY_LAST_UPDATED = 'kamui_config_last_updated';

            // GitHub Raw URL
            const GITHUB_YAML_URL = 'https://raw.githubusercontent.com/Yumeno/kamuicode-config-manager/main/kamuicode_model_memo.yaml';

            // GitHub Raw URL for MCP Tool Catalog
            const CATALOG_YAML_URL = 'https://raw.githubusercontent.com/Yumeno/kamuicode-config-manager/main/mcp_tool_catalog.yaml';

            return {
                // --- çŠ¶æ…‹ ---
                masterList: [],        // å…¨ãƒ¢ãƒ‡ãƒ«ã®ãƒªã‚¹ãƒˆ (JSONé †)
                filteredList: [],      // è¡¨ç¤ºç”¨ã®ãƒ•ã‚£ãƒ«ã‚¿æ¸ˆã¿ãƒªã‚¹ãƒˆ
                jsonFile: null,
                yamlFile: null,
                jsonContent: null,
                yamlContent: null,

                // --- è¤‡æ•°JSONå¯¾å¿œ ---
                secondaryJsonFiles: [],    // å‰¯JSONãƒ•ã‚¡ã‚¤ãƒ«ã®é…åˆ—
                secondaryJsonContents: [], // ãƒ‘ãƒ¼ã‚¹æ¸ˆã¿å‰¯JSONã®é…åˆ—
                mergeMode: 'main',         // ãƒãƒ¼ã‚¸ãƒ¢ãƒ¼ãƒ‰: 'main' | 'secondary' | 'both'
                mergedJsonContent: null,   // ãƒãƒ¼ã‚¸æ¸ˆã¿JSON
                originalKeyMap: {},        // ãƒªãƒãƒ¼ãƒ ã•ã‚ŒãŸã‚­ãƒ¼ -> å…ƒã®ã‚­ãƒ¼ ã®ãƒãƒƒãƒ—ï¼ˆä¸¡æ–¹ã‚’å«ã‚ã‚‹ãƒ¢ãƒ¼ãƒ‰ç”¨ï¼‰
                // ãƒã‚§ãƒƒã‚¯çŠ¶æ…‹ãƒ•ã‚¡ã‚¤ãƒ«ç”¨ã®å¤‰æ•°
                checkStateFile: null,
                checkStateContent: null,
                yamlLookup: new Map(), // YAMLé«˜é€Ÿæ¤œç´¢ç”¨
                categories: [],        // ãƒ•ã‚£ãƒ«ã‚¿ç”¨ã®ã‚«ãƒ†ã‚´ãƒªä¸€è¦§
                filesReady: false,
                errorMessage: '',
                successMessage: '',

                // ã‚½ãƒ¼ãƒˆçŠ¶æ…‹ (3çŠ¶æ…‹: 'asc', 'desc', 'none')
                sortState: { key: '', order: 'none' }, // key: 'name' or 'release_date'

                // --- YAMLèª­ã¿è¾¼ã¿ãƒ¢ãƒ¼ãƒ‰ ---
                yamlMode: 'standard',  // 'standard' | 'custom'
                yamlLastUpdated: '',   // æœ€çµ‚æ›´æ–°æ—¥æ™‚
                isLoadingYaml: false,  // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹

                // --- ãƒ•ã‚£ãƒ«ã‚¿ã¨ã‚ªãƒ—ã‚·ãƒ§ãƒ³ ---
                filterCategory: '',
                filterText: '',

                // å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å¤‰æ›´
                outputFileName: 'mcp-kamui-code-filtered',
                // ãƒã‚§ãƒƒã‚¯çŠ¶æ…‹YAMLã®å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«å (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ)
                outputCheckStateFileName: 'mcp-check-state',

                // --- MCPãƒ„ãƒ¼ãƒ«ã‚«ã‚¿ãƒ­ã‚°é–¢é€£ ---
                catalogData: null,           // ã‚«ã‚¿ãƒ­ã‚°å…¨ä½“ã®ãƒ‡ãƒ¼ã‚¿
                catalogLookup: new Map(),    // server_name -> ã‚µãƒ¼ãƒãƒ¼æƒ…å ±ã®ãƒãƒƒãƒ—
                catalogLoaded: false,        // ã‚«ã‚¿ãƒ­ã‚°èª­ã¿è¾¼ã¿æ¸ˆã¿ãƒ•ãƒ©ã‚°
                isLoadingCatalog: false,     // ã‚«ã‚¿ãƒ­ã‚°èª­ã¿è¾¼ã¿ä¸­ãƒ•ãƒ©ã‚°
                selectedServer: null,        // é¸æŠã•ã‚ŒãŸã‚µãƒ¼ãƒãƒ¼ï¼ˆãƒ„ãƒ¼ãƒ«è©³ç´°ç”¨ï¼‰
                showServerDialog: false,     // ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤ºãƒ•ãƒ©ã‚°

                // --- åˆæœŸåŒ– ---
                init() {
                    // LocalStorageã‹ã‚‰è¨­å®šã‚’å¾©å…ƒ
                    const savedMode = localStorage.getItem(LS_KEY_MODE);
                    const savedYamlData = localStorage.getItem(LS_KEY_YAML_DATA);
                    const savedLastUpdated = localStorage.getItem(LS_KEY_LAST_UPDATED);

                    if (savedMode) {
                        this.yamlMode = savedMode;
                    }
                    if (savedLastUpdated) {
                        this.yamlLastUpdated = savedLastUpdated;
                    }
                    if (savedYamlData) {
                        try {
                            this.yamlContent = jsyaml.load(savedYamlData, { schema: jsyaml.FAILSAFE_SCHEMA });
                        } catch (e) {
                            console.warn('ä¿å­˜ã•ã‚ŒãŸYAMLã®èª­ã¿è¾¼ã¿ã«å¤±æ•—:', e);
                        }
                    }
                },

                // --- ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ ---
                switchMode(mode) {
                    this.yamlMode = mode;
                    localStorage.setItem(LS_KEY_MODE, mode);

                    // ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆæ™‚ã«YAMLã‚’ã‚¯ãƒªã‚¢ã—ãªã„ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä¿æŒï¼‰
                    // ãŸã ã—ã€JSONãŒæ—¢ã«ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ãƒªã‚¹ãƒˆã‚’å†æ§‹ç¯‰
                    if (this.jsonContent) {
                        this.buildMasterList();
                    }
                },

                // --- æ¨™æº–ãƒ¢ãƒ¼ãƒ‰: GitHubã‹ã‚‰æœ€æ–°YAMLã‚’å–å¾— ---
                async fetchLatestYaml() {
                    this.isLoadingYaml = true;
                    this.errorMessage = '';
                    this.successMessage = '';

                    try {
                        const response = await fetch(GITHUB_YAML_URL);
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }
                        const yamlText = await response.text();

                        // YAMLã‚’ãƒ‘ãƒ¼ã‚¹
                        this.yamlContent = jsyaml.load(yamlText, { schema: jsyaml.FAILSAFE_SCHEMA });

                        // LocalStorageã«ä¿å­˜
                        const now = new Date().toLocaleString('ja-JP');
                        localStorage.setItem(LS_KEY_YAML_DATA, yamlText);
                        localStorage.setItem(LS_KEY_LAST_UPDATED, now);
                        this.yamlLastUpdated = now;

                        this.successMessage = 'ãƒ¢ãƒ‡ãƒ«æƒ…å ±ã‚’æœ€æ–°ç‰ˆã«æ›´æ–°ã—ã¾ã—ãŸã€‚';

                        // ãƒªã‚¹ãƒˆã‚’å†æ§‹ç¯‰
                        if (this.jsonContent) {
                            this.buildMasterList();
                        }
                    } catch (e) {
                        this.errorMessage = `æœ€æ–°YAMLã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: ${e.message}`;
                    } finally {
                        this.isLoadingYaml = false;
                    }
                },

                // --- ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ ---
                loadJson(event) {
                    this.errorMessage = ''; // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢
                    this.successMessage = '';
                    this.jsonFile = event.target.files[0];
                    if (this.jsonFile) {
                        this.readFile(this.jsonFile, (content) => {
                            try {
                                this.jsonContent = JSON.parse(content);
                                this.filesReady = true; // JSONãŒèª­ã¿è¾¼ã‚ãŸã‚‰UIè¡¨ç¤ºãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹
                                this.mergeAndBuildList(); // ãƒãƒ¼ã‚¸å‡¦ç†ã‚’å‘¼ã³å‡ºã—
                            } catch (e) {
                                this.errorMessage = `JSONã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: ${e.message}`;
                            }
                        });
                    }
                },

                // å‰¯JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€
                loadSecondaryJson(event) {
                    this.errorMessage = '';
                    this.successMessage = '';
                    const files = event.target.files;
                    if (files.length > 0) {
                        // æ—¢å­˜ã®å‰¯JSONã‚’ã‚¯ãƒªã‚¢ã—ã¦æ–°ã—ã„ã‚‚ã®ã‚’è¿½åŠ 
                        this.secondaryJsonFiles = [];
                        this.secondaryJsonContents = [];

                        let loadCount = 0;
                        const totalFiles = files.length;

                        for (let i = 0; i < files.length; i++) {
                            const file = files[i];
                            this.secondaryJsonFiles.push(file);

                            this.readFile(file, (content) => {
                                try {
                                    const parsed = JSON.parse(content);
                                    this.secondaryJsonContents.push({
                                        fileName: file.name,
                                        content: parsed
                                    });
                                    loadCount++;

                                    // ã™ã¹ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒèª­ã¿è¾¼ã¾ã‚ŒãŸã‚‰ãƒãƒ¼ã‚¸å®Ÿè¡Œ
                                    if (loadCount === totalFiles) {
                                        this.successMessage = `å‰¯JSON ${totalFiles}ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ`;
                                        this.mergeAndBuildList();
                                    }
                                } catch (e) {
                                    this.errorMessage = `å‰¯JSON "${file.name}" ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: ${e.message}`;
                                }
                            });
                        }
                    }
                },

                // å‰¯JSONã‚’ã‚¯ãƒªã‚¢
                clearSecondaryJson() {
                    this.secondaryJsonFiles = [];
                    this.secondaryJsonContents = [];
                    this.mergedJsonContent = null;
                    this.originalKeyMap = {}; // ãƒªã‚»ãƒƒãƒˆ
                    // ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›ã‚’ãƒªã‚»ãƒƒãƒˆ
                    const input = document.getElementById('secondaryJsonInput');
                    if (input) {
                        input.value = '';
                    }
                    // ãƒªã‚¹ãƒˆã‚’å†æ§‹ç¯‰
                    if (this.jsonContent) {
                        this.mergeAndBuildList();
                    }
                },

                // ãƒãƒ¼ã‚¸ãƒ¢ãƒ¼ãƒ‰ã‚’å¤‰æ›´
                setMergeMode(mode) {
                    this.mergeMode = mode;
                    // ä¸»JSONãŒã‚ã‚‹å ´åˆã¯ãƒªã‚¹ãƒˆã‚’å†æ§‹ç¯‰
                    if (this.jsonContent) {
                        this.mergeAndBuildList();
                    }
                },

                // JSONã‚’ãƒãƒ¼ã‚¸ã—ã¦ãƒªã‚¹ãƒˆã‚’æ§‹ç¯‰
                mergeAndBuildList() {
                    if (!this.jsonContent) {
                        return;
                    }

                    const mainServers = this.jsonContent.mcpServers || {};
                    let mergedServers = {};
                    this.originalKeyMap = {}; // ãƒªã‚»ãƒƒãƒˆ

                    // å‰¯JSONãŒãªã„å ´åˆã¯ä¸»ã®ã¿
                    if (this.secondaryJsonContents.length === 0) {
                        mergedServers = { ...mainServers };
                    } else {
                        // ãƒãƒ¼ã‚¸ãƒ¢ãƒ¼ãƒ‰ã«å¿œã˜ãŸå‡¦ç†
                        switch (this.mergeMode) {
                            case 'main':
                                // ä¸»ã‚’å„ªå…ˆ: å‰¯ã‚’å…ˆã«è¿½åŠ ã—ã€ä¸»ã§ä¸Šæ›¸ã
                                this.secondaryJsonContents.forEach(secondary => {
                                    const secServers = secondary.content.mcpServers || {};
                                    Object.entries(secServers).forEach(([key, value]) => {
                                        if (!mergedServers.hasOwnProperty(key) && !mainServers.hasOwnProperty(key)) {
                                            mergedServers[key] = value;
                                        }
                                    });
                                });
                                // ä¸»ã‚’è¿½åŠ ï¼ˆä¸Šæ›¸ãï¼‰
                                Object.assign(mergedServers, mainServers);
                                break;

                            case 'secondary':
                                // å‰¯ã‚’å„ªå…ˆ: ä¸»ã‚’å…ˆã«è¿½åŠ ã—ã€å‰¯ã§ä¸Šæ›¸ã
                                mergedServers = { ...mainServers };
                                this.secondaryJsonContents.forEach(secondary => {
                                    const secServers = secondary.content.mcpServers || {};
                                    Object.assign(mergedServers, secServers);
                                });
                                break;

                            case 'both':
                                // ä¸¡æ–¹ã‚’å«ã‚ã‚‹: é‡è¤‡ã‚­ãƒ¼ã«ã¯ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’è¿½åŠ 
                                const usedKeys = new Set();

                                // ä¸»ã‚’è¿½åŠ 
                                Object.entries(mainServers).forEach(([key, value]) => {
                                    mergedServers[key] = value;
                                    usedKeys.add(key);
                                });

                                // å‰¯ã‚’è¿½åŠ ï¼ˆé‡è¤‡æ™‚ã¯ãƒªãƒãƒ¼ãƒ ï¼‰
                                this.secondaryJsonContents.forEach(secondary => {
                                    const secServers = secondary.content.mcpServers || {};
                                    const baseName = secondary.fileName.replace(/\.json$/i, '');

                                    Object.entries(secServers).forEach(([key, value]) => {
                                        if (usedKeys.has(key)) {
                                            // é‡è¤‡: ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’è¿½åŠ 
                                            const newKey = `${key}_${baseName}`;
                                            mergedServers[newKey] = value;
                                            usedKeys.add(newKey);
                                            // å…ƒã®ã‚­ãƒ¼ã‚’è¨˜éŒ²ï¼ˆYAMLç…§åˆç”¨ï¼‰
                                            this.originalKeyMap[newKey] = key;
                                        } else {
                                            mergedServers[key] = value;
                                            usedKeys.add(key);
                                        }
                                    });
                                });
                                break;
                        }
                    }

                    // ãƒãƒ¼ã‚¸çµæœã‚’ä¿å­˜
                    this.mergedJsonContent = { mcpServers: mergedServers };

                    // ãƒªã‚¹ãƒˆã‚’æ§‹ç¯‰
                    this.buildMasterList();
                },

                // ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ¼ãƒ‰: ãƒ­ãƒ¼ã‚«ãƒ«YAMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€
                loadCustomYaml(event) {
                    this.errorMessage = '';
                    this.successMessage = '';
                    this.yamlFile = event.target.files[0];
                    if (this.yamlFile) {
                        this.readFile(this.yamlFile, (content) => {
                            try {
                                this.yamlContent = jsyaml.load(content, { schema: jsyaml.FAILSAFE_SCHEMA });

                                // LocalStorageã«ä¿å­˜
                                const now = new Date().toLocaleString('ja-JP');
                                localStorage.setItem(LS_KEY_YAML_DATA, content);
                                localStorage.setItem(LS_KEY_LAST_UPDATED, now);
                                this.yamlLastUpdated = now;

                                this.successMessage = `ã‚«ã‚¹ã‚¿ãƒ YAMLã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ: ${this.yamlFile.name}`;
                                this.checkReady();
                            } catch (e) {
                                this.errorMessage = `YAMLã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: ${e.message}`;
                            }
                        });
                    }
                },

                // ãƒã‚§ãƒƒã‚¯çŠ¶æ…‹YAMLã‚’èª­ã¿è¾¼ã‚€é–¢æ•°
                loadCheckState(event) {
                    this.errorMessage = '';
                    this.checkStateFile = event.target.files[0];
                    if (this.checkStateFile) {
                        this.readFile(this.checkStateFile, (content) => {
                            try {
                                this.checkStateContent = jsyaml.load(content);
                                this.applyCheckState(); // èª­ã¿è¾¼ã‚“ã ã‚‰ã™ãã«é©ç”¨
                            } catch (e) {
                                this.errorMessage = `çŠ¶æ…‹YAMLã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: ${e.message}`;
                            }
                        });
                    }
                    // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚ŒãŸå ´åˆã‚‚è€ƒæ…®ã—ã€inputã®å€¤ã‚’ãƒªã‚»ãƒƒãƒˆ
                    event.target.value = '';
                },
                readFile(file, callback) {
                    const reader = new FileReader();
                    reader.onload = (e) => callback(e.target.result);
                    reader.onerror = () => {
                        this.errorMessage = `ãƒ•ã‚¡ã‚¤ãƒ« ${file.name} ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚`;
                    };
                    reader.readAsText(file);
                },

                // æ—¥ä»˜æ–‡å­—åˆ—ã‚’ãƒ‘ãƒ¼ã‚¹ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
                parseDate(dateStr) {
                    if (!dateStr) return null;

                    // YYYYå¹´MMæœˆDDæ—¥
                    let match = dateStr.match(/(\d{4})å¹´(\d{1,2})æœˆ(\d{1,2})æ—¥/);
                    if (match) {
                        return new Date(parseInt(match[1]), parseInt(match[2]) - 1, parseInt(match[3]));
                    }

                    // YYYYå¹´MMæœˆé ƒ ã¾ãŸã¯ YYYYå¹´MMæœˆ
                    match = dateStr.match(/(\d{4})å¹´(\d{1,2})æœˆ/);
                    if (match) {
                        return new Date(parseInt(match[1]), parseInt(match[2]) - 1, 1);
                    }

                    // ä¸æ˜, N/A ãªã©
                    return null;
                },

                // --- ãƒ‡ãƒ¼ã‚¿å‡¦ç† ---
                buildYamlLookup(yamlData) {
                    this.yamlLookup.clear();
                    if (!yamlData || !yamlData.ai_models) return;

                    for (const [category, models] of Object.entries(yamlData.ai_models)) {
                        if (Array.isArray(models)) {
                            models.forEach(model => {
                                if (model && model.server_name) {
                                    model.category = category; // ã‚«ãƒ†ã‚´ãƒªæƒ…å ±ã‚’ãƒ¢ãƒ‡ãƒ«è‡ªä½“ã«è¿½åŠ 
                                    this.yamlLookup.set(model.server_name, model);
                                }
                            });
                        }
                    }
                },
                checkReady() {
                    // JSONã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒã‚ã‚Œã°ã€YAMLãŒãªãã¦ã‚‚ãƒªã‚¹ãƒˆæ§‹ç¯‰ã‚’å®Ÿè¡Œ
                    if (this.jsonContent) {
                        this.mergeAndBuildList();
                    }
                },
                buildMasterList() {
                    this.errorMessage = '';
                    this.masterList = [];
                    this.filteredList = [];

                    try {
                        this.buildYamlLookup(this.yamlContent);
                    } catch (e) {
                        this.errorMessage = `YAMLã®æ§‹é€ ã®å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼: ${e.message}`;
                        return;
                    }

                    // ãƒãƒ¼ã‚¸æ¸ˆã¿JSONã‚’ä½¿ç”¨ï¼ˆãªã‘ã‚Œã°å…ƒã®jsonContentï¼‰
                    const sourceJson = this.mergedJsonContent || this.jsonContent;
                    const jsonServers = sourceJson.mcpServers;
                    if (!jsonServers) {
                        this.errorMessage = "JSONãƒ•ã‚¡ã‚¤ãƒ«ã« 'mcpServers' ã‚­ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚";
                        return;
                    }

                    for (const serverName of Object.keys(jsonServers)) {
                        const serverInfo = jsonServers[serverName];
                        // ãƒªãƒãƒ¼ãƒ ã•ã‚ŒãŸã‚­ãƒ¼ã®å ´åˆã¯å…ƒã®ã‚­ãƒ¼ã§YAMLç…§åˆ
                        const lookupKey = this.originalKeyMap[serverName] || serverName;
                        const yamlDetails = this.yamlLookup.get(lookupKey);
                        let sortableDate = null; // ã‚½ãƒ¼ãƒˆç”¨ã®æ—¥ä»˜ãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™

                        if (yamlDetails) {
                            sortableDate = this.parseDate(yamlDetails.release_date); // æ—¥ä»˜ã‚’ãƒ‘ãƒ¼ã‚¹
                            // YAMLã«æƒ…å ±ãŒã‚ã‚‹å ´åˆ
                            this.masterList.push({
                                checked: true,
                                server_name: serverName,
                                category: yamlDetails.category,
                                name: yamlDetails.name,
                                release_date: yamlDetails.release_date,
                                features: yamlDetails.features,
                                sortable_date: sortableDate, // ã‚½ãƒ¼ãƒˆç”¨æ—¥ä»˜ã‚’è¿½åŠ 
                                server_info: serverInfo
                            });
                        } else {
                            // JSONã«ã—ã‹æƒ…å ±ãŒãªã„å ´åˆ
                            this.masterList.push({
                                checked: true,
                                server_name: serverName,
                                category: '(æœªåˆ†é¡)',
                                name: serverName, // ãƒ¢ãƒ‡ãƒ«åã¨ã—ã¦ã‚­ãƒ¼ã‚’ä½¿ç”¨
                                release_date: '',
                                features: serverInfo.description || '(è§£èª¬ãªã—)', // JSONã®descriptionã‚’æµç”¨
                                sortable_date: null, // ã‚½ãƒ¼ãƒˆç”¨æ—¥ä»˜(null)ã‚’è¿½åŠ 
                                server_info: serverInfo
                            });
                        }
                    }
                    this.populateCategories();
                    this.applyCheckState(); // ãƒªã‚¹ãƒˆæ§‹ç¯‰å¾Œã«çŠ¶æ…‹ã‚’é©ç”¨
                    this.applyFilters(); // ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆã‚½ãƒ¼ãƒˆå«ã‚€ï¼‰ã‚’é©ç”¨
                },
                populateCategories() {
                    const categories = new Set(this.masterList.map(m => m.category));
                    this.categories = ['(æœªåˆ†é¡)', ...Array.from(categories).filter(c => c !== '(æœªåˆ†é¡)').sort()];
                },

                // YAMLã‚’ã‚¯ãƒªã‚¢ã—ã¦ãƒªã‚¹ãƒˆã‚’å†æ§‹ç¯‰ã™ã‚‹é–¢æ•°
                clearYaml() {
                    this.yamlFile = null;
                    this.yamlContent = null;
                    this.yamlLookup.clear();
                    this.yamlLastUpdated = '';

                    // LocalStorageã‹ã‚‰ã‚‚å‰Šé™¤
                    localStorage.removeItem(LS_KEY_YAML_DATA);
                    localStorage.removeItem(LS_KEY_LAST_UPDATED);

                    // ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›ã®å€¤ã‚’ãƒªã‚»ãƒƒãƒˆ
                    const yamlInput = document.getElementById('customYamlInput');
                    if (yamlInput) {
                        yamlInput.value = '';
                    }
                    // YAMLãªã—ã§ãƒªã‚¹ãƒˆã‚’å†æ§‹ç¯‰ (JSONãŒã‚ã‚‹å ´åˆã®ã¿)
                    if (this.jsonContent) {
                        this.buildMasterList();
                    }
                },

                // ãƒã‚§ãƒƒã‚¯çŠ¶æ…‹ã‚’ã‚¯ãƒªã‚¢ã™ã‚‹é–¢æ•°
                clearCheckState() {
                    this.checkStateFile = null;
                    this.checkStateContent = null;
                    // inputã®å€¤ã‚’ãƒªã‚»ãƒƒãƒˆ
                    const checkStateInput = this.$refs.checkStateInput;
                    if (checkStateInput) {
                        checkStateInput.value = '';
                    }
                    // masterListã®ãƒã‚§ãƒƒã‚¯ã‚’ã™ã¹ã¦trueã«æˆ»ã™
                    if (this.masterList.length > 0) {
                        this.masterList.forEach(model => model.checked = true);
                        this.applyFilters(); // UIã‚’æ›´æ–°
                    }
                },

                // ãƒã‚§ãƒƒã‚¯çŠ¶æ…‹ã‚’masterListã«é©ç”¨ã™ã‚‹é–¢æ•°
                applyCheckState() {
                    if (!this.checkStateContent || this.masterList.length === 0) {
                        return; // çŠ¶æ…‹ãƒ‡ãƒ¼ã‚¿ãŒãªã„ã‹ã€ãƒªã‚¹ãƒˆãŒã¾ã ãªã„å ´åˆã¯ä½•ã‚‚ã—ãªã„
                    }

                    this.masterList.forEach(model => {
                        const serverName = model.server_name;
                        // çŠ¶æ…‹YAMLã«ã‚­ãƒ¼ãŒå­˜åœ¨ã™ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                        if (this.checkStateContent.hasOwnProperty(serverName)) {
                            model.checked = this.checkStateContent[serverName];
                        }
                        // å­˜åœ¨ã—ãªã„ã‚­ãƒ¼ã¯å¤‰æ›´ã—ãªã„ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®trueã®ã¾ã¾ï¼‰
                    });

                    this.applyFilters(); // UIã‚’æ›´æ–°
                },

                // --- UIæ“ä½œ ---
                applyFilters() {
                    const category = this.filterCategory;
                    const text = this.filterText.toLowerCase();

                    // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚° (ã“ã®æ™‚ç‚¹ã§ã¯ masterList ã®é †åº = JSONé †)
                    this.filteredList = this.masterList.filter(model => {
                        const categoryMatch = !category || model.category === category;
                        const textMatch = !text ||
                                          model.name.toLowerCase().includes(text) ||
                                          (model.features && model.features.toLowerCase().includes(text)) || // featuresãŒnullã§ãªã„ã‹ãƒã‚§ãƒƒã‚¯
                                          model.server_name.toLowerCase().includes(text);
                        return categoryMatch && textMatch;
                    });

                    // --- ã‚½ãƒ¼ãƒˆå‡¦ç† (çŠ¶æ…‹ãŒ 'none' ã§ãªã„å ´åˆã®ã¿å®Ÿè¡Œ) ---
                    if (this.sortState.order !== 'none') {
                        const isAsc = this.sortState.order === 'asc';

                        this.filteredList.sort((a, b) => {
                            let valA, valB;

                            if (this.sortState.key === 'release_date') {
                                valA = a.sortable_date;
                                valB = b.sortable_date;

                                // null (ä¸æ˜ãªæ—¥ä»˜) ã®æ‰±ã„: æ˜‡é †ã§ã¯æœ€å¾Œã€é™é †ã§ã¯æœ€åˆ
                                if (valA === null && valB === null) return 0;
                                if (valA === null) return isAsc ? 1 : -1;
                                if (valB === null) return isAsc ? -1 : 1;

                            } else {
                                // 'name' ã¾ãŸã¯ä»–ã®ã‚­ãƒ¼ã§ã®ã‚½ãƒ¼ãƒˆ
                                valA = a[this.sortState.key];
                                valB = b[this.sortState.key];
                            }

                            // å®Ÿéš›ã®æ¯”è¼ƒ
                            if (valA < valB) {
                                return isAsc ? -1 : 1;
                            }
                            if (valA > valB) {
                                return isAsc ? 1 : -1;
                            }
                            return 0;
                        });
                    }
                    // sortState.order ãŒ 'none' ã®å ´åˆã¯ã€ãƒ•ã‚£ãƒ«ã‚¿ã•ã‚ŒãŸã ã‘ã®ãƒªã‚¹ãƒˆ (JSONé †) ãŒãã®ã¾ã¾ä½¿ã‚ã‚Œã‚‹
                },

                // ã‚½ãƒ¼ãƒˆå®Ÿè¡Œç”¨ã®é–¢æ•° (3çŠ¶æ…‹åˆ‡ã‚Šæ›¿ãˆ)
                sortBy(key) {
                    if (this.sortState.key === key) {
                        // åŒã˜ã‚­ãƒ¼ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸå ´åˆ
                        if (this.sortState.order === 'asc') {
                            this.sortState.order = 'desc';
                        } else if (this.sortState.order === 'desc') {
                            this.sortState.order = 'none'; // è§£é™¤ (JSONé †ã«æˆ»ã‚‹)
                        } else {
                            this.sortState.order = 'asc';
                        }
                    } else {
                        // åˆ¥ã®ã‚­ãƒ¼ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸå ´åˆ
                        this.sortState.key = key;
                        this.sortState.order = 'asc'; // æ˜‡é †ã§é–‹å§‹
                    }
                    // ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆã¨ã‚½ãƒ¼ãƒˆï¼‰ã‚’å†é©ç”¨
                    this.applyFilters();
                },

                // ã‚½ãƒ¼ãƒˆã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤ºç”¨ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼
                getSortIcon(key) {
                    if (this.sortState.key !== key || this.sortState.order === 'none') {
                        return 'â–²â–¼'; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ (ã‚½ãƒ¼ãƒˆè§£é™¤çŠ¶æ…‹)
                    }
                    if (this.sortState.order === 'asc') {
                        return 'â–²'; // æ˜‡é †
                    }
                    return 'â–¼'; // é™é †
                },

                toggleAll(checkState) {
                    // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã•ã‚ŒãŸãƒªã‚¹ãƒˆ *ã ã‘* ã‚’ãƒˆã‚°ãƒ«ã™ã‚‹
                    this.filteredList.forEach(model => {
                        const originalModel = this.masterList.find(m => m.server_name === model.server_name);
                        if (originalModel) {
                            originalModel.checked = checkState;
                        }
                    });
                    // ãƒ•ã‚£ãƒ«ã‚¿ã‚’å†é©ç”¨ã—ã¦è¡¨ç¤ºã‚’æ›´æ–°
                    this.applyFilters();
                },
                generateJson() {
                    const output = {
                        mcpServers: {}
                    };

                    this.masterList
                        .filter(model => model.checked)
                        .forEach(model => {
                            let finalServerInfo = model.server_info;
                            output.mcpServers[model.server_name] = finalServerInfo;
                        });

                    const blob = new Blob([JSON.stringify(output, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;

                    const fileName = this.outputFileName.trim() ? `${this.outputFileName.trim()}.json` : 'mcp-kamui-code-filtered.json';
                    a.download = fileName;

                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                },

                // ãƒã‚§ãƒƒã‚¯çŠ¶æ…‹ã‚’YAMLã¨ã—ã¦ä¿å­˜ã™ã‚‹é–¢æ•°
                generateCheckStateYaml() {
                    const output = {};
                    // masterListå…¨ä½“ã‚’ãƒ«ãƒ¼ãƒ—ã—ã€çŠ¶æ…‹ã‚’è¨˜éŒ²
                    this.masterList.forEach(model => {
                        output[model.server_name] = model.checked;
                    });

                    let yamlString;
                    try {
                        yamlString = jsyaml.dump(output);
                    } catch (e) {
                        this.errorMessage = `çŠ¶æ…‹YAMLã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: ${e.message}`;
                        return;
                    }

                    const blob = new Blob([yamlString], { type: 'text/yaml' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;

                    // â˜… ãƒ•ã‚¡ã‚¤ãƒ«åå…¥åŠ›æ¬„ã‚’å‰Šé™¤ã—ãŸãŸã‚ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆåã‚’ä½¿ç”¨
                    const fileName = `${this.outputCheckStateFileName}.yaml`;
                    a.download = fileName;

                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                },

                // --- MCPãƒ„ãƒ¼ãƒ«ã‚«ã‚¿ãƒ­ã‚°é–¢é€£ã®ãƒ¡ã‚½ãƒƒãƒ‰ ---

                // ã‚«ã‚¿ãƒ­ã‚°ã‚’GitHubã‹ã‚‰èª­ã¿è¾¼ã‚€
                async loadCatalog() {
                    this.isLoadingCatalog = true;
                    this.errorMessage = '';
                    this.successMessage = '';

                    try {
                        const response = await fetch(CATALOG_YAML_URL);
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }
                        const yamlText = await response.text();

                        // YAMLã‚’ãƒ‘ãƒ¼ã‚¹
                        this.catalogData = jsyaml.load(yamlText, { schema: jsyaml.FAILSAFE_SCHEMA });

                        if (this.catalogData && this.catalogData.servers) {
                            this.buildCatalogLookup();
                            this.catalogLoaded = true;
                            this.successMessage = `MCPãƒ„ãƒ¼ãƒ«ã‚«ã‚¿ãƒ­ã‚°ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼ˆ${this.catalogData.servers.length}ã‚µãƒ¼ãƒãƒ¼ï¼‰`;
                        } else {
                            throw new Error('ã‚«ã‚¿ãƒ­ã‚°ãƒ‡ãƒ¼ã‚¿ã®å½¢å¼ãŒä¸æ­£ã§ã™');
                        }
                    } catch (e) {
                        this.errorMessage = `ã‚«ã‚¿ãƒ­ã‚°ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ${e.message}`;
                    } finally {
                        this.isLoadingCatalog = false;
                    }
                },

                // ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã‚«ã‚¿ãƒ­ã‚°ã‚’èª­ã¿è¾¼ã‚€
                loadCatalogFromFile(event) {
                    this.errorMessage = '';
                    this.successMessage = '';
                    const file = event.target.files[0];
                    if (file) {
                        this.isLoadingCatalog = true;
                        this.readFile(file, (content) => {
                            try {
                                this.catalogData = jsyaml.load(content, { schema: jsyaml.FAILSAFE_SCHEMA });

                                if (this.catalogData && this.catalogData.servers) {
                                    this.buildCatalogLookup();
                                    this.catalogLoaded = true;
                                    this.successMessage = `MCPãƒ„ãƒ¼ãƒ«ã‚«ã‚¿ãƒ­ã‚°ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼ˆ${this.catalogData.servers.length}ã‚µãƒ¼ãƒãƒ¼ï¼‰`;
                                } else {
                                    throw new Error('ã‚«ã‚¿ãƒ­ã‚°ãƒ‡ãƒ¼ã‚¿ã®å½¢å¼ãŒä¸æ­£ã§ã™');
                                }
                            } catch (e) {
                                this.errorMessage = `ã‚«ã‚¿ãƒ­ã‚°YAMLã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: ${e.message}`;
                            } finally {
                                this.isLoadingCatalog = false;
                            }
                        });
                    }
                    event.target.value = '';
                },

                // ã‚«ã‚¿ãƒ­ã‚°ã®Lookupã‚’æ§‹ç¯‰ï¼ˆserver_name -> ã‚µãƒ¼ãƒãƒ¼æƒ…å ±ï¼‰
                buildCatalogLookup() {
                    this.catalogLookup.clear();
                    if (!this.catalogData || !this.catalogData.servers) return;

                    this.catalogData.servers.forEach(server => {
                        if (server && server.id) {
                            this.catalogLookup.set(server.id, server);
                        }
                    });
                },

                // server_nameã«å¯¾å¿œã™ã‚‹ã‚«ã‚¿ãƒ­ã‚°æƒ…å ±ã‚’å–å¾—
                getCatalogServer(serverName) {
                    // ãƒªãƒãƒ¼ãƒ ã•ã‚ŒãŸã‚­ãƒ¼ã®å ´åˆã¯å…ƒã®ã‚­ãƒ¼ã§ç…§åˆ
                    const lookupKey = this.originalKeyMap[serverName] || serverName;
                    return this.catalogLookup.get(lookupKey);
                },

                // server_nameã«å¯¾å¿œã™ã‚‹ãƒ„ãƒ¼ãƒ«æ•°ã‚’å–å¾—
                getToolCount(serverName) {
                    // ãƒªãƒãƒ¼ãƒ ã•ã‚ŒãŸã‚­ãƒ¼ã®å ´åˆã¯å…ƒã®ã‚­ãƒ¼ã§ç…§åˆ
                    const lookupKey = this.originalKeyMap[serverName] || serverName;
                    const server = this.catalogLookup.get(lookupKey);
                    return server && server.tools ? server.tools.length : 0;
                },

                // ã‚µãƒ¼ãƒãƒ¼è©³ç´°ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‹ãï¼ˆserver_nameã‹ã‚‰ï¼‰
                openToolDialog(serverName) {
                    // ãƒªãƒãƒ¼ãƒ ã•ã‚ŒãŸã‚­ãƒ¼ã®å ´åˆã¯å…ƒã®ã‚­ãƒ¼ã§ç…§åˆ
                    const lookupKey = this.originalKeyMap[serverName] || serverName;
                    const server = this.catalogLookup.get(lookupKey);
                    if (server) {
                        this.selectedServer = server;
                        this.showServerDialog = true;
                        document.body.style.overflow = 'hidden';
                    }
                },

                // ã‚µãƒ¼ãƒãƒ¼è©³ç´°ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‰ã˜ã‚‹
                closeServerDialog() {
                    this.showServerDialog = false;
                    this.selectedServer = null;
                    document.body.style.overflow = '';
                },

                // ãƒ„ãƒ¼ãƒ«ã‚’submit -> status -> resultã®é †ã«ã‚½ãƒ¼ãƒˆã—ã¦å–å¾—
                getSortedTools(server) {
                    if (!server || !server.tools) return [];

                    const order = { 'submit': 0, 'status': 1, 'result': 2 };

                    return [...server.tools].sort((a, b) => {
                        // ãƒ„ãƒ¼ãƒ«åã®æœ«å°¾ã‹ã‚‰ã‚¿ã‚¤ãƒ—ã‚’åˆ¤å®š
                        const getType = (name) => {
                            if (name.endsWith('_submit') || name.includes('submit')) return 'submit';
                            if (name.endsWith('_status') || name.includes('status')) return 'status';
                            if (name.endsWith('_result') || name.includes('result')) return 'result';
                            return 'other';
                        };

                        const typeA = getType(a.name);
                        const typeB = getType(b.name);
                        const orderA = order[typeA] !== undefined ? order[typeA] : 3;
                        const orderB = order[typeB] !== undefined ? order[typeB] : 3;

                        return orderA - orderB;
                    });
                },

                // ã‚«ã‚¿ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢
                clearCatalog() {
                    this.catalogData = null;
                    this.catalogLookup.clear();
                    this.catalogLoaded = false;
                    this.selectedServer = null;
                    this.showServerDialog = false;
                }
            };
        }
    </script>
</head>
<body class="bg-gray-100 text-gray-900">

    <div class="container mx-auto p-4 lg:p-8" x-data="modelManager()" x-init="init()">
        <header class="mb-6">
            <!-- ã‚¿ã‚¤ãƒˆãƒ« -->
            <h1 class="text-3xl font-bold text-gray-800">kamuicode Config Manager</h1>
            <p class="text-gray-600 mt-1">JSON (mcpServers) ã¨ ãƒ¢ãƒ‡ãƒ«æƒ…å ± (YAML) ã‚’ä½¿ã£ã¦AIãƒ¢ãƒ‡ãƒ«æ§‹æˆã‚’ç®¡ç†ã—ã¾ã™ã€‚</p>
        </header>

        <!-- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
        <template x-if="errorMessage">
            <div class="mb-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg relative" role="alert">
                <strong class="font-bold">ã‚¨ãƒ©ãƒ¼: </strong>
                <span class="block sm:inline" x-text="errorMessage"></span>
            </div>
        </template>

        <!-- æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
        <template x-if="successMessage">
            <div class="mb-4 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg relative" role="alert">
                <span class="block sm:inline" x-text="successMessage"></span>
            </div>
        </template>

        <!-- 1. ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›ã‚¨ãƒªã‚¢ (JSONã¨YAML) -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <!-- 1. JSONèª­ã¿è¾¼ã¿ï¼ˆè¤‡æ•°JSONå¯¾å¿œï¼‰ -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-lg font-semibold mb-3">1. mcpServers (.json)</h2>

                <!-- ä¸»JSONå…¥åŠ› -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                        ä¸» (Main) JSON <span class="text-red-500">*</span>
                    </label>
                    <input type="file" @change="loadJson" accept=".json" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 transition-colors">
                    <p class="mt-1 text-xs text-gray-500">åŸºæœ¬ã¨ãªã‚‹è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„</p>
                </div>

                <!-- å‰¯JSONå…¥åŠ› -->
                <div class="mb-4">
                    <div class="flex justify-between items-center mb-1">
                        <label class="block text-sm font-medium text-gray-700">
                            å‰¯ (Secondary) JSON <span class="text-gray-400 text-xs">(ä»»æ„ãƒ»è¤‡æ•°å¯)</span>
                        </label>
                        <template x-if="secondaryJsonContents.length > 0">
                            <button @click="clearSecondaryJson" class="px-2 py-1 text-xs font-medium text-red-700 bg-red-100 rounded-lg hover:bg-red-200 transition-colors">
                                ã‚¯ãƒªã‚¢
                            </button>
                        </template>
                    </div>
                    <input type="file" id="secondaryJsonInput" @change="loadSecondaryJson" accept=".json" multiple class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-green-50 file:text-green-700 hover:file:bg-green-100 transition-colors">
                    <p class="mt-1 text-xs text-gray-500">è¿½åŠ ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¤‡æ•°é¸æŠã§ãã¾ã™</p>

                    <!-- èª­ã¿è¾¼ã¿æ¸ˆã¿å‰¯JSONã®è¡¨ç¤º -->
                    <template x-if="secondaryJsonContents.length > 0">
                        <div class="mt-2 p-2 bg-green-50 rounded-lg">
                            <p class="text-xs text-green-700 font-medium mb-1">èª­ã¿è¾¼ã¿æ¸ˆã¿:</p>
                            <ul class="text-xs text-green-600 space-y-0.5">
                                <template x-for="(sec, idx) in secondaryJsonContents" :key="idx">
                                    <li class="flex items-center">
                                        <span class="mr-1">â€¢</span>
                                        <span x-text="sec.fileName"></span>
                                        <span class="ml-1 text-green-500" x-text="`(${Object.keys(sec.content.mcpServers || {}).length}ã‚µãƒ¼ãƒãƒ¼)`"></span>
                                    </li>
                                </template>
                            </ul>
                        </div>
                    </template>
                </div>

                <!-- ãƒãƒ¼ã‚¸è¨­å®šï¼ˆå‰¯JSONãŒã‚ã‚‹å ´åˆã®ã¿è¡¨ç¤ºï¼‰ -->
                <template x-if="secondaryJsonContents.length > 0">
                    <div class="border-t border-gray-200 pt-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">ãƒãƒ¼ã‚¸è¨­å®šï¼ˆç«¶åˆè§£æ±ºãƒ«ãƒ¼ãƒ«ï¼‰</label>
                        <div class="space-y-2">
                            <!-- ä¸»ã‚’å„ªå…ˆ -->
                            <label class="flex items-start space-x-2 p-2 border rounded-lg cursor-pointer transition-colors"
                                   :class="mergeMode === 'main' ? 'border-blue-500 bg-blue-50' : 'border-gray-200 hover:bg-gray-50'">
                                <input type="radio" name="mergeMode" value="main"
                                       x-model="mergeMode" @change="setMergeMode('main')"
                                       class="mt-0.5 h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500">
                                <div class="flex-1">
                                    <span class="block text-sm font-medium text-gray-900">ğŸ”˜ ä¸»ã‚’å„ªå…ˆ (Default)</span>
                                    <span class="block text-xs text-gray-500">é‡è¤‡ã‚­ãƒ¼ã¯ä¸»ã®è¨­å®šã‚’ä½¿ç”¨ã—ã€å‰¯ã¯ç„¡è¦–</span>
                                </div>
                            </label>

                            <!-- å‰¯ã‚’å„ªå…ˆ -->
                            <label class="flex items-start space-x-2 p-2 border rounded-lg cursor-pointer transition-colors"
                                   :class="mergeMode === 'secondary' ? 'border-blue-500 bg-blue-50' : 'border-gray-200 hover:bg-gray-50'">
                                <input type="radio" name="mergeMode" value="secondary"
                                       x-model="mergeMode" @change="setMergeMode('secondary')"
                                       class="mt-0.5 h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500">
                                <div class="flex-1">
                                    <span class="block text-sm font-medium text-gray-900">âšª å‰¯ã‚’å„ªå…ˆ (Override)</span>
                                    <span class="block text-xs text-gray-500">é‡è¤‡ã‚­ãƒ¼ã¯å‰¯ã®è¨­å®šã§ä¸Šæ›¸ã</span>
                                </div>
                            </label>

                            <!-- ä¸¡æ–¹ã‚’å«ã‚ã‚‹ -->
                            <label class="flex items-start space-x-2 p-2 border rounded-lg cursor-pointer transition-colors"
                                   :class="mergeMode === 'both' ? 'border-blue-500 bg-blue-50' : 'border-gray-200 hover:bg-gray-50'">
                                <input type="radio" name="mergeMode" value="both"
                                       x-model="mergeMode" @change="setMergeMode('both')"
                                       class="mt-0.5 h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500">
                                <div class="flex-1">
                                    <span class="block text-sm font-medium text-gray-900">âšª ä¸¡æ–¹ã‚’å«ã‚ã‚‹ (Keep Both)</span>
                                    <span class="block text-xs text-gray-500">é‡è¤‡ã‚­ãƒ¼ã¯ä¸¡æ–¹è¡¨ç¤ºï¼ˆå‰¯ã«ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ä»˜ä¸ï¼‰</span>
                                </div>
                            </label>
                        </div>
                    </div>
                </template>
            </div>

            <!-- 2. ãƒ¢ãƒ‡ãƒ«æƒ…å ± (YAML) èª­ã¿è¾¼ã¿ - æ–°UI -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <div class="flex justify-between items-center mb-3">
                    <h2 class="text-lg font-semibold">2. ãƒ¢ãƒ‡ãƒ«æƒ…å ± (YAML) <span class="text-sm font-normal text-gray-500">(ä»»æ„)</span></h2>
                    <template x-if="yamlContent">
                        <button @click="clearYaml" class="px-2 py-1 text-xs font-medium text-red-700 bg-red-100 rounded-lg hover:bg-red-200 transition-colors">ã‚¯ãƒªã‚¢</button>
                    </template>
                </div>

                <!-- ãƒ¢ãƒ¼ãƒ‰é¸æŠãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ -->
                <div class="space-y-4">
                    <!-- æ¨™æº–ãƒ¢ãƒ¼ãƒ‰ -->
                    <label class="flex items-start space-x-3 p-3 border rounded-lg cursor-pointer transition-colors"
                           :class="yamlMode === 'standard' ? 'border-indigo-500 bg-indigo-50' : 'border-gray-200 hover:bg-gray-50'">
                        <input type="radio" name="yamlMode" value="standard"
                               x-model="yamlMode" @change="switchMode('standard')"
                               class="mt-1 h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                        <div class="flex-1">
                            <span class="block font-medium text-gray-900">æ¨™æº–ãƒ¢ãƒ‡ãƒ«æƒ…å ±ã‚’ä½¿ç”¨</span>
                            <span class="block text-xs text-gray-500 mt-1">GitHubã‹ã‚‰æœ€æ–°ã®ãƒ¢ãƒ‡ãƒ«å®šç¾©ã‚’å–å¾—ã—ã¾ã™</span>

                            <!-- æ¨™æº–ãƒ¢ãƒ¼ãƒ‰è©³ç´° (é¸æŠæ™‚ã®ã¿è¡¨ç¤º) -->
                            <template x-if="yamlMode === 'standard'">
                                <div class="mt-3 pt-3 border-t border-gray-200">
                                    <!-- æœªèª­ã¿è¾¼ã¿æ™‚: èª­ã¿è¾¼ã¿ã‚’ä¿ƒã™UI -->
                                    <template x-if="!yamlLastUpdated && !isLoadingYaml">
                                        <div class="text-center">
                                            <p class="text-xs text-amber-600 mb-2">ãƒ¢ãƒ‡ãƒ«æƒ…å ±ãŒã¾ã èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“</p>
                                            <button @click="fetchLatestYaml"
                                                    class="w-full px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-lg hover:bg-green-700 transition-colors">
                                                ãƒ¢ãƒ‡ãƒ«æƒ…å ±ã‚’èª­ã¿è¾¼ã‚€
                                            </button>
                                        </div>
                                    </template>
                                    <!-- èª­ã¿è¾¼ã¿ä¸­ -->
                                    <template x-if="isLoadingYaml">
                                        <div class="text-center">
                                            <p class="text-xs text-gray-600">èª­ã¿è¾¼ã¿ä¸­...</p>
                                        </div>
                                    </template>
                                    <!-- èª­ã¿è¾¼ã¿æ¸ˆã¿: æ›´æ–°æ—¥æ™‚ã¨æ›´æ–°ãƒœã‚¿ãƒ³ -->
                                    <template x-if="yamlLastUpdated && !isLoadingYaml">
                                        <div class="flex items-center justify-between">
                                            <div class="text-xs text-gray-600">
                                                <span>æœ€çµ‚æ›´æ–°: <span x-text="yamlLastUpdated"></span></span>
                                            </div>
                                            <button @click="fetchLatestYaml"
                                                    class="px-3 py-1.5 text-xs font-medium text-white bg-indigo-600 rounded-lg hover:bg-indigo-700 transition-colors">
                                                æœ€æ–°ã«æ›´æ–°
                                            </button>
                                        </div>
                                    </template>
                                </div>
                            </template>
                        </div>
                    </label>

                    <!-- ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ¼ãƒ‰ -->
                    <label class="flex items-start space-x-3 p-3 border rounded-lg cursor-pointer transition-colors"
                           :class="yamlMode === 'custom' ? 'border-indigo-500 bg-indigo-50' : 'border-gray-200 hover:bg-gray-50'">
                        <input type="radio" name="yamlMode" value="custom"
                               x-model="yamlMode" @change="switchMode('custom')"
                               class="mt-1 h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                        <div class="flex-1">
                            <span class="block font-medium text-gray-900">ã‚«ã‚¹ã‚¿ãƒ YAMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨</span>
                            <span class="block text-xs text-gray-500 mt-1">ãƒ­ãƒ¼ã‚«ãƒ«ã®ä»»æ„ã®YAMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã§ãã¾ã™</span>

                            <!-- ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ¼ãƒ‰è©³ç´° (é¸æŠæ™‚ã®ã¿è¡¨ç¤º) -->
                            <template x-if="yamlMode === 'custom'">
                                <div class="mt-3 pt-3 border-t border-gray-200">
                                    <input type="file" id="customYamlInput" @change="loadCustomYaml" accept=".yaml, .yml"
                                           class="block w-full text-sm text-gray-500 file:mr-4 file:py-1.5 file:px-3 file:rounded-lg file:border-0 file:text-xs file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 transition-colors">
                                    <template x-if="yamlLastUpdated && yamlMode === 'custom'">
                                        <div class="mt-2 text-xs text-gray-600">
                                            æœ€çµ‚èª­ã¿è¾¼ã¿: <span x-text="yamlLastUpdated"></span>
                                        </div>
                                    </template>
                                </div>
                            </template>
                        </div>
                    </label>
                </div>
            </div>
        </div>

        <!-- â˜… 3. ãƒ¢ãƒ‡ãƒ«ä¸€è¦§ãƒ†ãƒ¼ãƒ–ãƒ« (ãƒ•ã‚¡ã‚¤ãƒ«ãŒæº–å‚™OKãªã‚‰è¡¨ç¤º) -->
        <template x-if="filesReady">
            <div class="bg-white rounded-lg shadow-md overflow-hidden">
                <!-- â˜…â˜…â˜… ãƒ˜ãƒƒãƒ€ãƒ¼: ã‚¿ã‚¤ãƒˆãƒ« ã¨ çŠ¶æ…‹I/Oãƒœã‚¿ãƒ³ â˜…â˜…â˜… -->
                <div class="p-4 md:p-6 border-b border-gray-200">
                    <div class="flex flex-col md:flex-row justify-between md:items-center gap-3">
                        <!-- ã‚¿ã‚¤ãƒˆãƒ« -->
                        <h2 class="text-xl font-semibold">
                            3. ãƒ¢ãƒ‡ãƒ«ä¸€è¦§
                            <span class="text-base font-normal text-gray-600" x-text="`(${filteredList.length} / ${masterList.length} ä»¶)`"></span>
                        </h2>

                        <!-- ãƒœã‚¿ãƒ³ã‚°ãƒ«ãƒ¼ãƒ— -->
                        <div class="flex flex-wrap items-center gap-2">
                            <!-- ãƒ„ãƒ¼ãƒ«ã‚«ã‚¿ãƒ­ã‚°èª­ã¿è¾¼ã¿ -->
                            <button @click="loadCatalog"
                                    :disabled="isLoadingCatalog"
                                    class="px-3 py-1.5 text-xs font-medium text-purple-700 bg-purple-100 rounded-lg hover:bg-purple-200 transition-colors disabled:opacity-50">
                                <span x-show="!isLoadingCatalog && !catalogLoaded">ãƒ„ãƒ¼ãƒ«ã‚«ã‚¿ãƒ­ã‚°èª­è¾¼</span>
                                <span x-show="isLoadingCatalog">èª­è¾¼ä¸­...</span>
                                <span x-show="catalogLoaded && !isLoadingCatalog">ã‚«ã‚¿ãƒ­ã‚°èª­è¾¼æ¸ˆ</span>
                            </button>
                            <template x-if="catalogLoaded">
                                <button @click="clearCatalog" class="px-2 py-1 text-xs font-medium text-red-700 bg-red-100 rounded-lg hover:bg-red-200 transition-colors">
                                    ã‚«ã‚¿ãƒ­ã‚°ã‚¯ãƒªã‚¢
                                </button>
                            </template>

                            <span class="text-gray-300">|</span>

                            <!-- çŠ¶æ…‹èª­ã¿è¾¼ã¿ãƒœã‚¿ãƒ³ (inputã‚’éš ã™) -->
                            <input type="file" @change="loadCheckState" accept=".yaml, .yml" id="checkStateInput" x-ref="checkStateInput" class="hidden">
                            <button type="button" @click="$refs.checkStateInput.click()" class="px-3 py-1.5 text-xs font-medium text-green-700 bg-green-100 rounded-lg hover:bg-green-200 transition-colors">
                                çŠ¶æ…‹ã‚’èª­ã¿è¾¼ã‚€
                            </button>
                            <!-- çŠ¶æ…‹ä¿å­˜ãƒœã‚¿ãƒ³ -->
                            <button @click="generateCheckStateYaml" class="px-3 py-1.5 text-xs font-medium text-green-800 bg-green-200 rounded-lg hover:bg-green-300 transition-colors">
                                çŠ¶æ…‹ã‚’ä¿å­˜
                            </button>
                            <!-- ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³ (èª­ã¿è¾¼ã¿å¾Œ) -->
                            <template x-if="checkStateContent">
                                <button @click="clearCheckState" class="flex-shrink-0 px-2 py-1 text-xs font-medium text-red-700 bg-red-100 rounded-lg hover:bg-red-200 transition-colors" title="èª­ã¿è¾¼ã‚“ã çŠ¶æ…‹ã‚’ã‚¯ãƒªã‚¢">
                                    ã‚¯ãƒªã‚¢
                                </button>
                            </template>
                        </div>
                    </div>
                </div>

                <!-- â˜…â˜…â˜… ãƒ•ã‚£ãƒ«ã‚¿ ã¨ ä¸€æ‹¬ãƒã‚§ãƒƒã‚¯/è§£é™¤ â˜…â˜…â˜… -->
                <div class="p-4 md:p-6 border-b border-gray-200 bg-gray-50/50">
                    <!-- ãƒ•ã‚£ãƒ«ã‚¿æ©Ÿèƒ½ -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="filterCategory" class="block text-sm font-medium text-gray-700">ã‚«ãƒ†ã‚´ãƒªã§çµã‚Šè¾¼ã¿</label>
                            <select id="filterCategory" x-model="filterCategory" @change="applyFilters" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                <option value="">ã™ã¹ã¦ã®ã‚«ãƒ†ã‚´ãƒª</option>
                                <template x-for="category in categories" :key="category">
                                    <option :value="category" x-text="category"></option>
                                </template>
                            </select>
                        </div>
                        <div>
                            <label for="filterText" class="block text-sm font-medium text-gray-700">ãƒ†ã‚­ã‚¹ãƒˆã§çµã‚Šè¾¼ã¿</label>
                            <input type="search" id="filterText" x-model="filterText" @input.debounce.300ms="applyFilters" placeholder="ãƒ¢ãƒ‡ãƒ«å, è§£èª¬..." class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        </div>
                    </div>

                    <hr class="my-4 border-gray-200">

                    <!-- ä¸€æ‹¬ãƒã‚§ãƒƒã‚¯/è§£é™¤ãƒœã‚¿ãƒ³ (å³å¯„ã›) -->
                    <div class="flex justify-end space-x-2">
                         <button @click="toggleAll(true)" class="px-3 py-1.5 text-xs font-medium text-blue-700 bg-blue-100 rounded-lg hover:bg-blue-200 transition-colors">ãƒ•ã‚£ãƒ«ã‚¿å†…ã™ã¹ã¦ãƒã‚§ãƒƒã‚¯</button>
                         <button @click="toggleAll(false)" class="px-3 py-1.5 text-xs font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">ãƒ•ã‚£ãƒ«ã‚¿å†…ã™ã¹ã¦è§£é™¤</button>
                    </div>
                </div>

                <!-- ãƒ†ãƒ¼ãƒ–ãƒ«ã‚³ãƒ³ãƒ†ãƒŠ -->
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="w-16 px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    <!-- ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ -->
                                </th>
                                <th scope="col" class="w-48 px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ã‚«ãƒ†ã‚´ãƒª</th>

                                <!-- ã€Œãƒ¢ãƒ‡ãƒ«åã€ã®ãƒ˜ãƒƒãƒ€ãƒ¼ (ã‚½ãƒ¼ãƒˆå¯¾å¿œ) -->
                                <th scope="col" class="w-64 px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" @click="sortBy('name')">
                                    <div class="flex items-center">
                                        ãƒ¢ãƒ‡ãƒ«å
                                        <span class="ml-1 text-gray-700 sort-icon"
                                              :class="{ 'opacity-100': sortState.key === 'name' }"
                                              x-text="getSortIcon('name')"></span>
                                    </div>
                                </th>

                                <!-- ã€Œãƒªãƒªãƒ¼ã‚¹æ™‚æœŸã€ã®ãƒ˜ãƒƒãƒ€ãƒ¼ (ã‚½ãƒ¼ãƒˆå¯¾å¿œ) -->
                                <th scope="col" class="w-40 px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" @click="sortBy('release_date')">
                                    <div class="flex items-center">
                                        ãƒªãƒªãƒ¼ã‚¹æ™‚æœŸ
                                        <span class="ml-1 text-gray-700 sort-icon"
                                              :class="{ 'opacity-100': sortState.key === 'release_date' }"
                                              x-text="getSortIcon('release_date')"></span>
                                    </div>
                                </th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">è§£èª¬</th>
                                <th scope="col" class="w-28 px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">ãƒ„ãƒ¼ãƒ«è©³ç´°</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <template x-if="filteredList.length === 0">
                                <tr>
                                    <td colspan="6" class="px-6 py-10 text-center text-gray-500">
                                        ãƒ•ã‚¡ã‚¤ãƒ«ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ãªã„ã‹ã€ãƒ•ã‚£ãƒ«ã‚¿ã«ä¸€è‡´ã™ã‚‹ãƒ¢ãƒ‡ãƒ«ãŒã‚ã‚Šã¾ã›ã‚“ã€‚
                                    </td>
                                </tr>
                            </template>
                            <template x-for="model in filteredList" :key="model.server_name">
                                <tr class="hover:bg-gray-50">
                                    <td class="px-4 py-4 text-center">
                                        <!-- masterList ã®çŠ¶æ…‹ã‚’ç›´æ¥ãƒˆã‚°ãƒ«ã™ã‚‹ -->
                                        <input type="checkbox" x-model="masterList.find(m => m.server_name === model.server_name).checked" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                    </td>
                                    <td class="px-4 py-4 text-sm text-gray-600" x-text="model.category"></td>
                                    <td class="px-4 py-4 text-sm font-medium text-gray-900">
                                        <span x-text="model.name"></span>
                                        <span class="block text-xs text-gray-400" x-text="model.server_name"></span>
                                    </td>
                                    <td class="px-4 py-4 text-sm text-gray-600" x-text="model.release_date"></td>
                                    <td class="px-4 py-4 text-sm text-gray-600" x-text="model.features"></td>
                                    <td class="px-4 py-4 text-center">
                                        <template x-if="catalogLoaded && getCatalogServer(model.server_name)">
                                            <button @click.stop="openToolDialog(model.server_name)"
                                                    class="px-2 py-1 text-xs font-medium text-purple-700 bg-purple-100 rounded hover:bg-purple-200 transition-colors">
                                                è©³ç´° (<span x-text="getToolCount(model.server_name)"></span>)
                                            </button>
                                        </template>
                                        <template x-if="!catalogLoaded">
                                            <span class="text-xs text-gray-400">-</span>
                                        </template>
                                        <template x-if="catalogLoaded && !getCatalogServer(model.server_name)">
                                            <span class="text-xs text-gray-400">N/A</span>
                                        </template>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
            </div>
        </template>

        <!-- â˜… 4. JSONã‚’å‡ºåŠ› (ãƒ•ã‚¡ã‚¤ãƒ«ãŒæº–å‚™OKãªã‚‰è¡¨ç¤º) -->
        <template x-if="filesReady">
            <div class="mt-6 bg-white p-6 rounded-lg shadow-md">
                <!-- â˜… è¦‹å‡ºã—ç•ªå·ã‚’å¤‰æ›´ -->
                <h2 class="text-xl font-semibold mb-4">4. æœ€çµ‚JSONã‚’å‡ºåŠ›</h2>
                <div class="flex flex-col md:flex-row gap-4">
                    <div class="flex-grow">
                        <label for="outputFileName" class="block text-sm font-medium text-gray-700">å‡ºåŠ›JSONãƒ•ã‚¡ã‚¤ãƒ«å</label>
                        <input type="text" id="outputFileName" x-model="outputFileName" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    </div>
                    <div class="flex-shrink-0 md:mt-6">
                        <button @click="generateJson" class="w-full md:w-auto px-6 py-2.5 text-base font-semibold text-white bg-indigo-600 rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-colors">
                            JSONã‚’ç”Ÿæˆã—ã¦ä¿å­˜
                        </button>
                    </div>
                </div>
            </div>
        </template>

        <!-- ==================== ãƒ„ãƒ¼ãƒ«è©³ç´°ãƒ€ã‚¤ã‚¢ãƒ­ã‚° ==================== -->
        <template x-if="showServerDialog && selectedServer">
            <div class="fixed inset-0 z-50 overflow-y-auto" @keydown.escape.window="closeServerDialog()">
                <!-- ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
                <div class="fixed inset-0 bg-black bg-opacity-50 transition-opacity" @click="closeServerDialog()"></div>

                <!-- ãƒ€ã‚¤ã‚¢ãƒ­ã‚°æœ¬ä½“ -->
                <div class="flex min-h-full items-center justify-center p-4">
                    <div class="relative bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden" @click.stop>
                        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
                        <div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-start z-10">
                            <div class="flex-1 pr-4">
                                <h3 class="text-xl font-bold text-gray-900 mb-1" x-text="selectedServer.id"></h3>
                                <p class="text-sm text-gray-500 break-all" x-text="selectedServer.url"></p>
                            </div>
                            <button @click="closeServerDialog()"
                                    class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>

                        <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
                        <div class="px-6 py-4 overflow-y-auto" style="max-height: calc(90vh - 100px);">
                            <!-- ãƒ„ãƒ¼ãƒ«ä¸€è¦§ -->
                            <h4 class="text-lg font-semibold text-gray-800 mb-4">ãƒ„ãƒ¼ãƒ«ä¸€è¦§ (<span x-text="selectedServer.tools ? selectedServer.tools.length : 0"></span>)</h4>

                            <template x-if="selectedServer.tools && selectedServer.tools.length > 0">
                                <div class="space-y-4">
                                    <template x-for="(tool, index) in getSortedTools(selectedServer)" :key="index">
                                        <div class="border border-gray-200 rounded-lg overflow-hidden">
                                            <!-- ãƒ„ãƒ¼ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ -->
                                            <div class="bg-gray-50 px-4 py-3 border-b border-gray-200">
                                                <h5 class="font-mono font-semibold text-purple-700" x-text="tool.name"></h5>
                                            </div>
                                            <!-- ãƒ„ãƒ¼ãƒ«è©³ç´° -->
                                            <div class="p-4">
                                                <!-- èª¬æ˜ -->
                                                <p class="text-sm text-gray-700 mb-4" x-text="tool.description"></p>

                                                <!-- å…¥åŠ›ã‚¹ã‚­ãƒ¼ãƒ -->
                                                <template x-if="tool.inputSchema">
                                                    <div>
                                                        <h6 class="text-sm font-semibold text-gray-600 mb-2">å…¥åŠ›ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</h6>
                                                        <div class="bg-gray-50 rounded-lg p-3">
                                                            <template x-if="tool.inputSchema.properties">
                                                                <div class="space-y-3">
                                                                    <template x-for="(prop, propName) in tool.inputSchema.properties" :key="propName">
                                                                        <div class="flex flex-col sm:flex-row sm:items-start gap-1 sm:gap-3 p-2 bg-white rounded border border-gray-100">
                                                                            <div class="flex items-center gap-2">
                                                                                <code class="text-sm font-mono text-purple-600" x-text="propName"></code>
                                                                                <span class="px-1.5 py-0.5 text-xs font-medium bg-blue-100 text-blue-700 rounded" x-text="prop.type"></span>
                                                                                <template x-if="tool.inputSchema.required && tool.inputSchema.required.includes(propName)">
                                                                                    <span class="px-1.5 py-0.5 text-xs font-medium bg-red-100 text-red-700 rounded">å¿…é ˆ</span>
                                                                                </template>
                                                                            </div>
                                                                            <p class="text-sm text-gray-600 flex-1" x-text="prop.description || '(èª¬æ˜ãªã—)'"></p>
                                                                        </div>
                                                                    </template>
                                                                </div>
                                                            </template>
                                                            <template x-if="!tool.inputSchema.properties">
                                                                <p class="text-sm text-gray-500 italic">ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãªã—</p>
                                                            </template>
                                                        </div>
                                                    </div>
                                                </template>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </template>

                            <template x-if="!selectedServer.tools || selectedServer.tools.length === 0">
                                <div class="text-center py-8 text-gray-500">
                                    ã“ã®ã‚µãƒ¼ãƒãƒ¼ã«ã¯ãƒ„ãƒ¼ãƒ«ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
            </div>
        </template>

    </div> <!-- /x-data="modelManager" -->
</body>
</html>
